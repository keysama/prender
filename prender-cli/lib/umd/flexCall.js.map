{"version":3,"file":"flexCall.js","sources":["../../src/flexCall.js"],"sourcesContent":["class FlexCall{\n    constructor(maxCall){\n      this.maxCall = maxCall;\n      this._queue = [];\n    }\n  \n    push(fn,context = null){\n      this._queue.push({\n        fn,\n        res : null,\n        status : \"block\",\n        index : this._queue.length,\n        context : context\n      });\n    }\n  \n    async run(){\n      let arr = [];\n      for(let i=0;i<this.maxCall;i++){\n        arr.push(this.runOne())\n      }\n      await Promise.all(arr);\n      return this._queue.sort((a,b) => a.index - b.index).map(item=>item.res);\n    }\n  \n    async runOne(){\n      let unit = this._queue.filter(item => item.status === \"block\")[0];\n      if(!unit){\n        return true;\n      }else{\n        unit.status = \"running\";\n        unit.res = await unit.fn.call(unit.context);\n        unit.status = \"finish\";\n        return await this.runOne();\n      }\n    }\n}\n\nmodule.exports = FlexCall;"],"names":["FlexCall","constructor","maxCall","_queue","push","fn","context","res","status","index","length","run","arr","i","runOne","Promise","all","sort","a","b","map","item","unit","filter","call","module","exports"],"mappings":";;;;;EAAA,MAAMA,QAAN,CAAc;EACVC,EAAAA,WAAW,CAACC,OAAD,EAAS;EAClB,SAAKA,OAAL,GAAeA,OAAf;EACA,SAAKC,MAAL,GAAc,EAAd;EACD;;EAEDC,EAAAA,IAAI,CAACC,EAAD,EAAIC,OAAO,GAAG,IAAd,EAAmB;EACrB,SAAKH,MAAL,CAAYC,IAAZ,CAAiB;EACfC,MAAAA,EADe;EAEfE,MAAAA,GAAG,EAAG,IAFS;EAGfC,MAAAA,MAAM,EAAG,OAHM;EAIfC,MAAAA,KAAK,EAAG,KAAKN,MAAL,CAAYO,MAJL;EAKfJ,MAAAA,OAAO,EAAGA;EALK,KAAjB;EAOD;;EAEQ,QAAHK,GAAG,GAAE;EACT,QAAIC,GAAG,GAAG,EAAV;;EACA,SAAI,IAAIC,CAAC,GAAC,CAAV,EAAYA,CAAC,GAAC,KAAKX,OAAnB,EAA2BW,CAAC,EAA5B,EAA+B;EAC7BD,MAAAA,GAAG,CAACR,IAAJ,CAAS,KAAKU,MAAL,EAAT;EACD;;EACD,UAAMC,OAAO,CAACC,GAAR,CAAYJ,GAAZ,CAAN;EACA,WAAO,KAAKT,MAAL,CAAYc,IAAZ,CAAiB,CAACC,CAAD,EAAGC,CAAH,KAASD,CAAC,CAACT,KAAF,GAAUU,CAAC,CAACV,KAAtC,EAA6CW,GAA7C,CAAiDC,IAAI,IAAEA,IAAI,CAACd,GAA5D,CAAP;EACD;;EAEW,QAANO,MAAM,GAAE;EACZ,QAAIQ,IAAI,GAAG,KAAKnB,MAAL,CAAYoB,MAAZ,CAAmBF,IAAI,IAAIA,IAAI,CAACb,MAAL,KAAgB,OAA3C,EAAoD,CAApD,CAAX;;EACA,QAAG,CAACc,IAAJ,EAAS;EACP,aAAO,IAAP;EACD,KAFD,MAEK;EACHA,MAAAA,IAAI,CAACd,MAAL,GAAc,SAAd;EACAc,MAAAA,IAAI,CAACf,GAAL,GAAW,MAAMe,IAAI,CAACjB,EAAL,CAAQmB,IAAR,CAAaF,IAAI,CAAChB,OAAlB,CAAjB;EACAgB,MAAAA,IAAI,CAACd,MAAL,GAAc,QAAd;EACA,aAAO,MAAM,KAAKM,MAAL,EAAb;EACD;EACF;;EAnCS;;EAsCdW,MAAM,CAACC,OAAP,GAAiB1B,QAAjB;;;;;;"}