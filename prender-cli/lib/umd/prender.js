!function(t){"function"==typeof define&&define.amd?define(t):t()}(function(){"use strict";const i=require("./flexCall"),l=require("./server"),d=require("./rerenderFactory"),r=require("./tools")["copyFile"];module.exports=class{constructor({routes:t,port:e,target:i,delta:r,output:s,show:o,incremental:a,exclude:h,timeout:n=0,pool:u=5,debug:c}){this.routes=t,this.port=e,this.target=i,this.delta=r,this.output=s,this.show=o,this.incremental=a,this.exclude=h,this.syncNum=u,this.debug=c,this.puppeteerOptions={headless:!o,defaultViewport:{width:1600,height:900}},this.pageOptions={waituntil:"networkidle0",timeout:n},this._server=new l({port:e,staticPath:i}),this._rerenderFactory=new d(this.puppeteerOptions,this.pageOptions,{targetDir:r,debug:c})}async start(){await this._server.initialize(),await this._rerenderFactory.initialize();const t=new i(this.syncNum);for(let i=0;i<this.routes.length;i++)t.push(async()=>{var t=this.routes[i];const e=await this._rerenderFactory.create(`http://localhost:${this.port}${t.path}`,t.mode);return e.start()});var e=await t.run();this.debug?console.log("finish rerender"):(await this._rerenderFactory.close(),this._server.destroy());try{this.incremental||(r(this.target,this.output,this.exclude),r(this.delta,this.output,this.exclude))}catch(t){}return e}}});
