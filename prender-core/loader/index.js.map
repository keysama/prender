{"version":3,"file":"index.js","sources":["../src/pkg/loader.js"],"sourcesContent":["const loaderUtils = require(\"loader-utils\");\nconst { prenderWrapperFunc } = require(\"prender-core/constants\")\n\nfunction defaultTestFunc(text){\n    if(/\\/\\*.*preFetch.*\\*\\//.test(text)){\n        let newText = text.replace(/\\/\\*.*preFetch.*\\*\\//,\"\");\n        let markUrl = newText.match(/\\(.*?\\)/g)[0].replace(/(\\(|\\)|\\s)/g,\"\");\n        let name = \"\";\n        let type = \"state\";\n        try{\n            type = text.match(/\\[.*\\]/g) ? text.match(/\\[.*\\]/g)[0].replace(/(\\[|\\])/g,\"\") : type;\n            name = text.match(/\\/\\*.*preFetch.*\\*\\//)[0].match(/[\\s].*[\\s]/g,\"\")[0].replace(/\\s/g,\"\").split(\":\")[1];\n        }catch(e){\n            return false;\n        }\n        return {\n            markUrl,\n            newText,\n            name,\n            type\n        }\n    };\n    return false;\n}\n\nfunction warp(statement,id,name,type){\n    let staticStatement = statement.replace(\"t(\",\"t.bind(axios,\");\n    console.log(`window.${prenderWrapperFunc}(${staticStatement},${id},\"${name}\",\"${type}\")`)\n    return `window.${prenderWrapperFunc}(${staticStatement},${id},\"${name}\",\"${type}\")`;\n}\n\nfunction prenderLoader(source){\n    let testFunc = defaultTestFunc;\n    \n    const options = loaderUtils.getOptions(this);\n\n    let axiosStatment = source.match(/axios[\\s]*\\.(get|post)\\(.*?\\)/g);\n    if(!axiosStatment){\n        return source;\n    }\n\n    axiosStatment = axiosStatment[0];\n\n    if(options.test){\n        testFunc = options.test;\n    }\n\n    let hitStatment = testFunc(axiosStatment);\n\n    if(!hitStatment){\n        return source;\n    }\n\n    const { markUrl,newText,name,type } = hitStatment;\n\n    return source.replace(axiosStatment,warp(newText,markUrl,name,type)) \n}\n\nmodule.exports = prenderLoader;\n\n"],"names":["loaderUtils","require","prenderWrapperFunc","defaultTestFunc","text","test","newText","replace","markUrl","match","name","type","split","e","warp","statement","id","staticStatement","console","log","prenderLoader","source","testFunc","options","getOptions","axiosStatment","hitStatment","module","exports"],"mappings":"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"}